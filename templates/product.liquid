<div class="container mx-auto px-4 py-8">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    <div>
      <!-- Product Image Carousel -->
      {% section 'product-images' %}
      {% if section.settings.enable_zoom %}
        <style>
          /* Use CSS transitions for smoother zoom effect */
          .product-images img {
            transition: transform 0.3s ease-in-out;
            will-change: transform;
          }
          .product-images img:hover {
            transform: scale(1.2);
          }
        </style>
      {% endif %}
    </div>
    <div>
      <!-- Product Information -->
      <h1 class="text-2xl font-bold text-deep-moss-black dark:text-mist-gray">{{ product.title }}</h1>
      {% if section.settings.show_vendor %}
        <p class="text-gray-700 dark:text-gray-300">Vendor: {{ product.vendor }}</p>
      {% endif %}
      <p class="text-gray-700 dark:text-gray-300">{{ product.price | money }}</p>
      <button onclick="toggleWishlist('{{ product.handle }}')" class="bg-gray-200 dark:bg-gray-700 rounded-full p-2" aria-label="Add to Wishlist">
        <svg class="w-4 h-4 text-gray-700 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>
      </button>

      <!-- Product Badges -->
      {% if product.available == false %}
        <span class="inline-flex items-center rounded-full bg-red-50 px-2 py-0.5 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/10">
          Sold out
        </span>
      {% endif %}

      {% if product.compare_at_price > product.price %}
        <span class="inline-flex items-center rounded-full bg-green-50 px-2 py-0.5 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/10">
          Sale
        </span>
      {% endif %}

      <!-- Size Selector -->
      {% if product.variants.size > 1 %}
        <div class="mt-4">
          <label for="size" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Size</label>
          <select id="size" name="size" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-500 dark:text-white rounded-lg">
            {% for variant in product.variants %}
              <option value="{{ variant.id }}">{{ variant.title }}</option>
            {% endfor %}
          </select>
        </div>
      {% endif %}

      <!-- In-Stock Status -->
      <div class="mt-4">
        {% if product.available %}
          <p class="text-green-500 font-semibold">In Stock</p>
        {% else %}
          <p class="text-red-500 font-semibold">Out of Stock</p>
        {% endif %}
      </div>

      <!-- Product Description -->
      <div class="mt-4">
        <button class="w-full text-left text-lg font-semibold text-deep-moss-black dark:text-mist-gray py-2 px-4 bg-gray-100 dark:bg-gray-700 rounded-lg" onclick="toggleSection('description')">
          Description
        </button>
        <div id="description" class="text-gray-700 dark:text-gray-300 hidden p-4 rounded-lg">
          {{ product.description }}
        </div>
      </div>

      <!-- Size Guide -->
      <div class="mt-4">
        <button class="w-full text-left text-lg font-semibold text-deep-moss-black dark:text-mist-gray py-2 px-4 bg-gray-100 dark:bg-gray-700 rounded-lg" onclick="toggleSection('size-guide')">
          Size Guide
        </button>
        <div id="size-guide" class="text-gray-700 dark:text-gray-300 hidden p-4 rounded-lg">
          <!-- Add Size Guide Content Here -->
          <p>Size guide information goes here.</p>
        </div>
      </div>

      <!-- Shipping Information -->
      <div class="mt-4">
        <button class="w-full text-left text-lg font-semibold text-deep-moss-black dark:text-mist-gray py-2 px-4 bg-gray-100 dark:bg-gray-700 rounded-lg" onclick="toggleSection('shipping')">
          Shipping Information
        </button>
        <div id="shipping" class="text-gray-700 dark:text-gray-300 hidden p-4 rounded-lg">
          <!-- Add Shipping Information Content Here -->
          <p>Shipping information goes here.</p>
        </div>
      </div>

      <!-- Add to Cart Form -->
      <form method="post" action="/cart/add" id="add-to-cart-form">
        <input type="hidden" name="id" value="{{ product.variants.first.id }}">
        <div class="mt-4">
          <button type="submit" class="btn-primary w-full rounded-lg">
            Add to Cart
          </button>
        </div>
      </form>
      <p id="add-to-cart-message" class="text-green-500 mt-2 hidden">Added to cart!</p>
    </div>
  </div>

  <!-- Countdown Timer -->
  {% section 'countdown-timer' %}

  <div class="divider"></div>

  <!-- Buy it With -->
  {% if product.metafields.products.related_products %}
    <div class="mt-8">
      <h2 class="section-title">Buy it With</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        {% for product_id in product.metafields.products.related_products.value %}
          {% assign related_product = all_products[product_id] %}
          {% if related_product %}
            <div class="product-card relative">
              <a href="{{ related_product.url }}" class="block">
                <div class="relative overflow-hidden">
                  <img src="{{ related_product.featured_image | img_url: 'medium' }}" alt="{{ related_product.title }}" class="transition-transform duration-300 hover:scale-110 lazy rounded-lg">
                  <div class="absolute inset-0 bg-black opacity-0 hover:opacity-20 transition-opacity duration-300"></div>
                </div>
                <h3 class="text-lg font-semibold text-deep-moss-black dark:text-mist-gray mt-2 hover-underline">{{ related_product.title }}</h3>
                <p class="text-gray-700 dark:text-gray-300">{{ related_product.price | money }}</p>
              </a>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  {% endif %}

  <div class="divider"></div>

  <!-- Related Products -->
  <div class="mt-8">
    <h2 class="section-title">You might also like</h2>
    {% section 'related-products' %}
  </div>

  <div class="divider"></div>

  <!-- Product Reviews -->
  {% section 'product-reviews' %}

  {% if section.settings.show_social_sharing %}
    <div class="mt-8">
      <h2 class="section-title">Share this product</h2>
      <div class="flex">
        <a href="#" class="social-button facebook-button mr-2" aria-label="Share on Facebook" onclick="shareOnFacebook('{{ product.url | url_encode }}', '{{ product.title | escape }}')">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.66 9.156 8.432 9.829V15.5H8.214v-3.043h2.219V9.963c0-2.204 1.333-3.403 3.219-3.403 1.816 0 2.741.133 2.741.133v3.013h-1.539c-1.012 0-1.244.63-1.244 1.533v1.857h2.531l-.408 3.043h-2.123v6.329C18.34 21.156 22 16.991 22 12z" clip-rule="evenodd" /></svg>
        </a>
        <a href="#" class="social-button twitter-button mr-2" aria-label="Share on Twitter" onclick="shareOnTwitter('{{ product.url | url_encode }}', '{{ product.title | escape }}')">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.29 20.251c7.547 0 11.672-6.253 11.672-11.673 0-.177 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.278 8.224 8.224 0 01-2.605.996 4.102 4.102 0 00-6.993 3.746 11.63 11.63 0 01-8.457-4.287 4.102 4.102 0 001.27 5.477 4.073 4.073 0 01-1.858-.513 4.102 4.102 0 003.834 2.85A8.236 8.236 0 011.96 18.72a11.65 11.65 0 006.328 1.584z" /></svg>
        </a>
        <a href="#" class="social-button pinterest-button" aria-label="Share on Pinterest" onclick="shareOnPinterest('{{ product.url | url_encode }}', '{{ product.featured_image | img_url: 'master' | url_encode }}', '{{ product.title | escape }}')">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12.315 2c2.43 0 2.788.01 3.79.051 1.806.043 2.482.484 2.781.941.309.465.535 1.01.574 1.445.041.435.042.89.042 1.349V12c0 .459-.001.914-.042 1.349-.04.435.266.98.574 1.445.299.457.975-.898 2.781.941 1.002.042 1.36.05 3.79.05s-2.788-.008-3.79-.051c-1.806-.043-2.482-.484-2.781-.941-.309.465-.535-1.01-.574-1.445-.041-.435-.042-.89-.042-1.349V12c0-.459.001-.914.042-1.349.04-.435.266.98.574-1.445.299-.457.975-.898 2.781-.941 1.002-.042 1.36.05 3.79-.05s-2.788-.008-3.79-.051c-1.806-.043-2.482-.484-2.781-.941-.309.465-.535-1.01-.574-1.445-.041-.435-.042-.89-.042-1.349V12c0-.459.001-.914.042-1.349.04-.435.266.98.574-1.445.299-.457.975-.898 2.781-.941 1.002-.042 1.36.05 3.79-.05s-2.788-.008-3.79-.051c-1.806-.043-2.482-.484-2.781-.941-.309.465-.535-1.01-.574-1.445-.041-.435-.042-.89-.042-1.349V12c0-.459.001-.914.042-1.349.04-.435.266.98.574-1.445.299-.457.975-.898 2.781-.941 1.002-.042 1.36.05 3.79-.05s-2.788-.008-3.79-.051c-1.806-.043-2.482-.484-2.781-.941-.309.465-.535-1.01-.574-1.445-.041-.435-.042-.89-.042-1.349V12c0-.459.001-.914.042-1.349.04-.435.266.98.574-1.445.299-.457.975-.898 2.781-.941 1.002-.042 1.36.05 3.79-.05s-2.788-.008-3.79-.051c-1.806-.043-2.482-.484-2.781-.941-.309.465-.535-1.01-.574-1.445-.041-.435-.042-.89-.042-1.349V12c0-.459.001-.914.042-1.349.04-.435.266.98.574-1.445.299-.457.975-.898 2.781-.941 1.002-.042 1.36.05 3.79-.05s-2.788-.008-3.79-.051c-1.806-.043-2.482-.484-2.781-.941-.309.465-.535-1.01-.574-1.445-.041-.435-.042-.89-.042-1.349V12c0-.459.001-.914.042-1.349.04-.435.266.98.574-1.445.299-.457.975-.898 2.781-.941 1.002-.042 1.36.05 3.79-.05s-2.788-.008-3.79-.051c-1.806-.043-2.482-.484-2.781-.941-.309.465-.535-1.01-.574-1.445-.041-.435-.042-.89-.042-1.349V12c0-.459.001-.914.042-1.349.04-.435.266.98.574-1.445.299-.457.975-.898 2.781-.941 1.002-.042 1.36.05 3.79-.05s-2.788-.008-3.79-.051c-1.806-.043-2.482-.484-2.781-.941-.309.465-.535-1.01-.574-1.445-.041-.435-.042-.89-.042-1.349V12c0-.459.001-.914.042-1.349.04-.435.266.98.574-1.445.299-.457.975-.898 2.781-.941 1.002-.042 1.36.05 3.79-.05zM12 15.194a3.194 3.194 0 100-6.388 3.194 3.194 0 000 6.388z" clip-rule="evenodd" /></svg>
        </a>
      </div>
    </div>
  {% endif %}
</div>

{% render 'product-schema' %}

<!-- Waitlist Modal -->
{% section 'waitlist-modal' %}

<!-- Sticky Add to Cart Bar (Mobile) -->
{% section 'sticky-add-to-cart' %}

<script>
  function toggleSection(id) {
    var element = document.getElementById(id);
    element.classList.toggle('hidden');
  }

  function toggleWishlist(handle) {
    console.log('Toggled wishlist for product:', handle);
  }

  document.addEventListener('DOMContentLoaded', function() {
    // Add recently viewed product
    let recentlyViewed = [];
    if (isLoggedIn) {
      recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed_user') || '[]');
    } else {
      recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
    }
    const productHandle = '{{ product.handle }}';
    if (!recentlyViewed.includes(productHandle)) {
      recentlyViewed.unshift(productHandle);
      if (recentlyViewed.length > 5) {
        recentlyViewed.pop();
      }
      if (isLoggedIn) {
        localStorage.setItem('recentlyViewed_user', JSON.stringify(recentlyViewed));
      } else {
        localStorage.setItem('recentlyViewed', JSON.stringify(recentlyViewed));
      }
    }

    // Add to cart feedback
    // Cache DOM elements
    const addToCartForm = document.querySelector('#add-to-cart-form');
    const addToCartMessage = document.querySelector('#add-to-cart-message');
    
    /**
     * Shows a message and hides it after a delay
     * @param {HTMLElement} element - The element to show/hide
     * @param {number} delay - Delay in milliseconds before hiding
     */
    function showTemporaryMessage(element, delay = 3000) {
      if (!element) return;
      
      element.classList.remove('hidden');
      setTimeout(() => {
        element.classList.add('hidden');
      }, delay);
    }
    
    /**
     * Adds an item to the cart
     * @param {FormData} formData - The form data to submit
     * @returns {Promise} - Promise that resolves when the item is added
     */
    async function addToCart(formData) {
      try {
        const response = await fetch('/cart/add.js', {
          method: 'POST',
          body: formData
        });
        
        if (response.ok) {
          showTemporaryMessage(addToCartMessage);
        } else {
          console.error('Error adding to cart:', response.statusText);
        }
        
        return response;
      } catch (error) {
        console.error('Error:', error);
      }
    }
    
    // Add event listener with null check
    if (addToCartForm) {
      addToCartForm.addEventListener('submit', function(event) {
        event.preventDefault();
        const formData = new FormData(this);
        addToCart(formData);
      });
    }
  });

  function shareOnFacebook(url, title) {
    window.open('https://www.facebook.com/sharer/sharer.php?u=' + url + '&t=' + title, '_blank');
  }

  function shareOnTwitter(url, title) {
    window.open('https://twitter.com/intent/tweet?url=' + url + '&text=' + title, '_blank');
  }

  function shareOnPinterest(url, image, title) {
    window.open('https://pinterest.com/pin/create/button/?url=' + url + '&media=' + image + '&description=' + title, '_blank');
  }
</script>

{% schema %}
{
  "name": "Product",
  "settings": [
    {
      "id": "show_vendor",
      "type": "checkbox",
      "label": "Show Vendor",
      "default": true
    },
    {
      "id": "enable_zoom",
      "type": "checkbox",
      "label": "Enable Image Zoom",
      "default": true
    },
    {
      "id": "show_social_sharing",
      "type": "checkbox",
      "label": "Show Social Sharing Buttons",
      "default": true
    }
  ]
}
{% endschema %}